// Emacs style mode select   -*- C++ -*-
//-----------------------------------------------------------------------------
//
// Copyright (C) 1993-1996 by id Software, Inc.
// Copyright (C) 1998-2000 by DooM Legacy Team.
//
// This program is free software; you can redistribute it and/or
// modify it under the terms of the GNU General Public License
// as published by the Free Software Foundation; either version 2
// of the License, or (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//-----------------------------------------------------------------------------
/// \file
/// \brief all external data is defined here
///
///	most of the data is loaded into different structures at run time
///	some internal structures shared by many modules are here

#ifndef __DOOMDATA__
#define __DOOMDATA__

// The most basic types we use, portability.
#include "doomtype.h"

// Some global defines, that configure the game.
#include "doomdef.h"

//
// Map level types.
// The following data structures define the persistent format
// used in the lumps of the WAD files.
//

// Lump order in a map WAD: each map needs a couple of lumps
// to provide a complete scene geometry description.
enum
{
	ML_LABEL,    // A separator, name, MAPxx
	ML_THINGS,   // Enemies, rings, monitors, scenery, etc.
	ML_LINEDEFS, // Linedefs, from editing
	ML_SIDEDEFS, // Sidedefs, from editing
	ML_VERTEXES, // Vertices, edited and BSP splits generated
	ML_SEGS,     // Linesegs, from linedefs split by BSP
	ML_SSECTORS, // Subsectors, list of linesegs
	ML_NODES,    // BSP nodes
	ML_SECTORS,  // Sectors, from editing
	ML_REJECT,    // LUT, sector-sector visibility
	ML_BLOCKMAP  // LUT, motion clipping, walls/grid element
};

// Unused object flag. // SRB2CBTODO: Is it possible to use this?
#define MTF_UNUSED 1

// Reverse gravity flag for objects
#define MTF_OBJECTFLIP 2

// Special flag used with certain objects
#define MTF_OBJECTSPECIAL 4

// Special flag number 2 used with certain objects // SRB2CBTODO: Rename to OBJECTSPECIAL 1 and 2 in code
#define MTF_AMBUSH 8

// NOTE: No more bits can be used unless the map format is changed,
// map objects use all the other bits for z-offsets.

#if defined(_MSC_VER)
#pragma pack(1)
#endif

// A single Vertex.
typedef struct
{
	short x, y;
}ATTRPACK  mapvertex_t;

// A SideDef, defining the visual appearance of a wall,
// by setting textures and offsets.
typedef struct
{
	short textureoffset, rowoffset;
	char toptexture[8], bottomtexture[8], midtexture[8];
	// Front sector, towards viewer.
	short sector;
} ATTRPACK mapsidedef_t;

// A LineDef, as used for editing, and as input
// to the BSP builder.
typedef struct
{
	short v1, v2;
	short flags;
	short special;
	short tag;
	// sidenum[1] will be 0xffff if one sided
	USHORT sidenum[2];
} ATTRPACK maplinedef_t;

//
// LineDef attributes.
//

// Solid, is an obstacle.
#define ML_EFFECT6              1

// Blocks monsters only. // SRB2CBTODO: Rename this flag
#define ML_BLOCKMONSTERS        2

// Backside will not be present at all if not two sided.
#define ML_TWOSIDED             4

// If a texture is pegged, the texture will have
// the end exposed to air held constant at the
// top or bottom of the texture (stairs or pulled
// down things) and will move with a height change
// of one of the neighbor sectors.
// Unpegged textures always have the first row of
// the texture at the top pixel of the line for both
// top and bottom textures (use next to windows).

// upper texture unpegged
#define ML_DONTPEGTOP           8

// lower texture unpegged
#define ML_DONTPEGBOTTOM       16

#define ML_EFFECT1             32

// Don't let Knuckles climb on this line
#define ML_NOCLIMB             64

#define ML_EFFECT2             128
#define ML_EFFECT3             256
#define ML_EFFECT4             512
#define ML_EFFECT5            1024

// New ones to disable lines for characters
#define ML_NOSONIC           2048
#define ML_NOTAILS           4096
#define ML_NOKNUX            8192

// Bounce off walls!
#define ML_BOUNCY           16384

#define ML_TFERLINE         32768

// Sector definition, from editing.
typedef struct
{
	short floorheight;
	short ceilingheight;
	char floorpic[8];
	char ceilingpic[8];
	short lightlevel;
	short special;
	short tag;
} ATTRPACK mapsector_t;

// SubSector, as generated by BSP.
typedef struct
{
	USHORT numsegs; // SRB2CBTODO: change to long someday
	// Index of first one, segs are stored sequentially.
	USHORT firstseg;
} ATTRPACK mapsubsector_t;


// LineSeg, generated by splitting LineDefs
// using partition lines selected by BSP builder.
typedef struct
{
	short v1, v2;
	short angle;
	short linedef;
	short side;
	short offset;
} ATTRPACK mapseg_t;

// BSP node structure.

// Indicate a leaf.
#define NF_SUBSECTOR 0x8000

typedef struct
{
	// Partition line from (x,y) to x+dx,y+dy)
	short x, y;
	short dx, dy;

	// Bounding box for each child, clip against view frustum.
	short bbox[2][4];

	// If NF_SUBSECTOR it's a subsector, else it's a node of another subtree.
	USHORT children[2];
} ATTRPACK mapnode_t;

// Thing definition, position, orientation and type,
// plus visibility flags and attributes.
typedef struct
{
	short x, y;
	short angle;
	USHORT type;
	USHORT options;
	short z;
	byte extrainfo; // SRB2CBTODO: Extend on this if possible
	struct mobj_s *mobj;
} ATTRPACK mapthing_t;

#define ZSHIFT 4

#if defined(_MSC_VER)
#pragma pack()
#endif

extern const char *Color_Names[MAXSKINCOLORS];

#define NUMMAPS 1035

#endif // __DOOMDATA__
